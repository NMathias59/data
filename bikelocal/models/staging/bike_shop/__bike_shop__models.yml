version: 2

models:
  - name: stg_bike_shop__brands
    description: |
      ## Vue d'ensemble
      Ce modèle de staging contient les données de référence pour les marques de vélos disponibles dans le système.

      ## Utilisation business
      - **Marketing** : Analyse des préférences de marque des clients
      - **Achats** : Négociation avec les fournisseurs de marques
      - **Reporting** : Répartition des ventes par marque

      ## Clés et contraintes
      - `brand_id` : Clé primaire auto-incrémentée
      - `brand_name` : Nom unique de la marque

      ## Exemple d'utilisation
      ```sql
      SELECT brand_name, COUNT(*) as product_count
      FROM stg_bike_shop__brands b
      JOIN stg_bike_shop__products p ON b.brand_id = p.brand_id
      GROUP BY brand_name
      ORDER BY product_count DESC
      ```
    columns:
      - name: brand_id
        description: "Identifiant unique de la marque (clé primaire)"
        tests:
          - not_null
          - unique
      - name: brand_name
        description: "Nom de la marque de vélo"
        tests:
          - not_null

  - name: stg_bike_shop__categories
    description: |
      ## Vue d'ensemble
      Définit la hiérarchie des catégories de produits du catalogue vélo.

      ## Utilisation business
      - **Navigation catalogue** : Organisation des produits en catégories
      - **Analyse des ventes** : Performance par catégorie
      - **Marketing** : Ciblage par type de produit

      ## Hiérarchie typique
      - Vélos (Route, VTT, Ville, Enfants)
      - Équipements (Casques, Vêtements, Accessoires)
      - Pièces (Freins, Transmission, Roues)
    columns:
      - name: category_id
        description: "Identifiant unique de la catégorie (clé primaire)"
        tests:
          - not_null
          - unique
      - name: category_name
        description: "Nom de la catégorie de produit"
        tests:
          - not_null

  - name: stg_bike_shop__customers
    description: |
      ## Vue d'ensemble
      Base clients du magasin de vélos avec informations de contact et localisation.

      ## Utilisation business
      - **CRM** : Gestion de la relation client
      - **Marketing** : Segmentation et campagnes ciblées
      - **Logistique** : Livraison et service client
      - **Analyse** : Comportement d'achat par région

      ## RGPD/Confidentialité
      Les données personnelles sont stockées de manière sécurisée et anonymisées dans les analyses agrégées.
    columns:
      - name: customer_id
        description: "Identifiant unique du client (clé primaire)"
        tests:
          - not_null
          - unique
      - name: first_name
        description: "Prénom du client"
        tests:
          - not_null
      - name: last_name
        description: "Nom de famille du client"
        tests:
          - not_null
      - name: phone
        description: "Numéro de téléphone du client"
      - name: email
        description: "Adresse email du client"
      - name: street
        description: "Adresse - rue du client"
      - name: city
        description: "Ville du client"
      - name: state
        description: "État/région du client"
      - name: zip_code
        description: "Code postal du client"

  - name: stg_bike_shop__products
    description: |
      ## Vue d'ensemble
      Catalogue complet des produits disponibles à la vente.

      ## Utilisation business
      - **E-commerce** : Affichage du catalogue en ligne
      - **Gestion des stocks** : Suivi des niveaux d'inventaire
      - **Pricing** : Stratégies de tarification
      - **Achats** : Réapprovisionnement automatique

      ## Relations importantes
      - Lié à `brands` et `categories` pour la classification
      - Lié à `stocks` pour la disponibilité
      - Lié à `order_items` pour les ventes
    columns:
      - name: product_id
        description: "Identifiant unique du produit (clé primaire)"
        tests:
          - not_null
          - unique
      - name: product_name
        description: "Nom du produit"
        tests:
          - not_null
      - name: brand_id
        description: "Référence vers la marque du produit"
        tests:
          - not_null
      - name: category_id
        description: "Référence vers la catégorie du produit"
        tests:
          - not_null
      - name: model_year
        description: "Année de modèle du produit"
      - name: list_price
        description: "Prix de vente conseillé du produit"
        tests:
          - not_null

  - name: stg_bike_shop__staffs
    description: |
      ## Vue d'ensemble
      Organigramme et informations du personnel travaillant dans les magasins.

      ## Utilisation business
      - **RH** : Gestion des employés et carrières
      - **Performance** : Analyse des ventes par employé
      - **Planning** : Gestion des horaires et congés
      - **Formation** : Suivi des compétences

      ## Hiérarchie
      - Managers de magasin
      - Vendeurs
      - Techniciens
    columns:
      - name: staff_id
        description: "Identifiant unique du membre du personnel (clé primaire)"
        tests:
          - not_null
          - unique
      - name: first_name
        description: "Prénom du membre du personnel"
        tests:
          - not_null
      - name: last_name
        description: "Nom de famille du membre du personnel"
        tests:
          - not_null
      - name: email
        description: "Adresse email professionnelle"
      - name: phone
        description: "Numéro de téléphone professionnel"
      - name: active
        description: "Statut d'activité du membre du personnel (1 = actif, 0 = inactif)"
        tests:
          - not_null
      - name: store_id
        description: "Magasin de rattachement du membre du personnel"
        tests:
          - not_null
      - name: manager_id
        description: "Référence vers le manager (peut être null pour les managers)"

  - name: stg_bike_shop__stocks
    description: |
      ## Vue d'ensemble
      Niveaux de stock en temps réel pour chaque produit dans chaque magasin.

      ## Utilisation business
      - **Supply chain** : Gestion des réapprovisionnements
      - **E-commerce** : Affichage de la disponibilité
      - **Ventes** : Alertes de rupture de stock
      - **Reporting** : Taux de rotation des stocks

      ## Métriques importantes
      - Stock disponible vs commandes en cours
      - Taux de rupture de stock
      - Valeur du stock par magasin
    columns:
      - name: store_id
        description: "Identifiant du magasin"
        tests:
          - not_null
      - name: product_id
        description: "Identifiant du produit"
        tests:
          - not_null
      - name: quantity
        description: "Quantité en stock pour ce produit dans ce magasin"
        tests:
          - not_null

  - name: stg_bike_shop__stores
    description: |
      ## Vue d'ensemble
      Informations détaillées sur chaque point de vente physique.

      ## Utilisation business
      - **Immobilier** : Gestion des baux et emplacements
      - **Marketing local** : Campagnes géolocalisées
      - **Logistique** : Gestion des livraisons
      - **RH** : Affectation du personnel

      ## Types de magasins
      - Magasins flagship (centres urbains)
      - Points de vente régionaux
      - Showrooms spécialisés
    columns:
      - name: store_id
        description: "Identifiant unique du magasin (clé primaire)"
        tests:
          - not_null
          - unique
      - name: store_name
        description: "Nom du magasin"
        tests:
          - not_null
      - name: phone
        description: "Numéro de téléphone du magasin"
      - name: email
        description: "Adresse email du magasin"
      - name: street
        description: "Adresse - rue du magasin"
      - name: city
        description: "Ville du magasin"
      - name: state
        description: "État/région du magasin"
      - name: zip_code
        description: "Code postal du magasin"

  - name: stg_bikelocal__orders
    description: |
      ## Vue d'ensemble
      Historique complet des commandes clients avec leur cycle de vie.

      ## Utilisation business
      - **Ventes** : Suivi des revenus et marges
      - **Service client** : Gestion des commandes et livraisons
      - **Logistique** : Planification des expéditions
      - **Finance** : Facturation et encaissements

      ## Statuts de commande
      - 1 : En attente de traitement
      - 2 : En cours de préparation
      - 3 : Expédiée
      - 4 : Livrée

      ## Métriques clés
      - Chiffre d'affaires par période
      - Taux de conversion commande → livraison
      - Délais moyens de traitement
    columns:
      - name: order_id
        description: "Identifiant unique de la commande (clé primaire)"
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Référence vers le client qui a passé la commande"
        tests:
          - not_null
      - name: order_status
        description: "Statut de la commande (1 = En attente, 2 = En cours, 3 = Expédiée, 4 = Livrée)"
        tests:
          - not_null
      - name: order_date
        description: "Date et heure de création de la commande"
        tests:
          - not_null
      - name: required_date
        description: "Date demandée pour la livraison"
      - name: shipped_date
        description: "Date effective d'expédition"
      - name: store_id
        description: "Magasin qui traite la commande"
        tests:
          - not_null
      - name: staff_id
        description: "Employé responsable de la commande"
        tests:
          - not_null

  - name: stg_bikelocal__order_items
    description: |
      ## Vue d'ensemble
      Détail ligne par ligne des produits commandés.

      ## Utilisation business
      - **Analyse produit** : Performance des articles
      - **Marges** : Calcul des profits par produit
      - **Recommandations** : Systèmes de suggestion
      - **Stocks** : Prévision des besoins

      ## Calculs importants
      - Prix total = `quantity * list_price * (1 - discount)`
      - Marge = `prix_total - coût_achat`
      - Popularité = nombre de commandes contenant ce produit
    columns:
      - name: order_id
        description: "Référence vers la commande"
        tests:
          - not_null
      - name: item_id
        description: "Numéro de ligne dans la commande"
        tests:
          - not_null
      - name: product_id
        description: "Produit commandé"
        tests:
          - not_null
      - name: quantity
        description: "Quantité commandée"
        tests:
          - not_null
      - name: list_price
        description: "Prix unitaire au moment de la commande"
        tests:
          - not_null
      - name: discount
        description: "Remise appliquée (en pourcentage ou montant)"
        tests:
          - not_null
