version: 2

models:
  - name: int_sales__customer_orders
    description: "Analyse RFM (Récence, Fréquence, Montant) et segmentation client pour optimiser la rétention et maximiser les revenus"
    columns:
      - name: customer_id
        description: "Identifiant unique du client"
      - name: first_name
        description: "Prénom du client"
      - name: last_name
        description: "Nom du client"
      - name: email
        description: "Adresse email du client"
      - name: phone
        description: "Numéro de téléphone du client"
      - name: city
        description: "Ville du client"
      - name: state
        description: "État du client"
      - name: total_orders
        description: "Nombre total de commandes du client"
      - name: total_amount
        description: "Montant total dépensé par le client"
      - name: first_order_date
        description: "Date de la première commande"
      - name: last_order_date
        description: "Date de la dernière commande"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: days_since_last_order
        description: "Jours depuis la dernière commande (RFM - Récence)"
      - name: order_frequency
        description: "Fréquence des commandes (RFM - Fréquence)"
      - name: monetary_value
        description: "Valeur monétaire totale (RFM - Montant)"
      - name: customer_segment
        description: "Segmentation client : Active, Recent, At Risk, Lost"

  - name: int_sales__product_performance
    description: "Performance détaillée par produit avec analyses temporelles pour optimiser l'assortiment"
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: ['product_id']
            severity: error
      - dbt_utils.expression_is_true:
          arguments:
            expression: "total_revenue >= 0"
      - not_null:
          column_name: product_id
    columns:
      - name: product_id
        description: "Identifiant unique du produit"
      - name: product_name
        description: "Nom du produit"
      - name: brand_name
        description: "Marque du produit"
      - name: category_name
        description: "Catégorie du produit"
      - name: model_year
        description: "Année modèle du produit"
      - name: original_price
        description: "Prix de vente original"
      - name: total_quantity_sold
        description: "Quantité totale vendue"
      - name: total_revenue
        description: "Revenus totaux générés"
      - name: total_orders
        description: "Nombre total de commandes contenant ce produit"
      - name: avg_selling_price
        description: "Prix de vente moyen"
      - name: first_sale_date
        description: "Date de première vente"
      - name: last_sale_date
        description: "Date de dernière vente"

  - name: int_sales__store_performance
    description: "Analyse des ventes par magasin pour optimiser les performances locales"
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: ['store_id']
            severity: error
      - dbt_utils.expression_is_true:
          arguments:
            expression: "total_revenue >= 0"
      - not_null:
          column_name: store_id
    columns:
      - name: store_id
        description: "Identifiant unique du magasin"
      - name: store_name
        description: "Nom du magasin"
      - name: city
        description: "Ville du magasin"
      - name: state
        description: "État du magasin"
      - name: street
        description: "Adresse du magasin"
      - name: zip_code
        description: "Code postal du magasin"
      - name: total_orders
        description: "Nombre total de commandes"
      - name: unique_customers
        description: "Nombre de clients uniques"
      - name: total_items_sold
        description: "Nombre total d'articles vendus"
      - name: total_revenue
        description: "Revenus totaux du magasin"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: first_order_date
        description: "Date de première commande"
      - name: last_order_date
        description: "Date de dernière commande"

  - name: int_sales__product_profitability
    description: "Analyse de rentabilité par produit avec marges estimées pour optimiser les prix et l'assortiment"
    columns:
      - name: product_id
        description: "Identifiant unique du produit"
      - name: product_name
        description: "Nom du produit"
      - name: brand_name
        description: "Marque du produit"
      - name: category_name
        description: "Catégorie du produit"
      - name: model_year
        description: "Année modèle du produit"
      - name: selling_price
        description: "Prix de vente"
      - name: estimated_cost_price
        description: "Prix de revient estimé (60% du prix de vente)"
      - name: estimated_margin
        description: "Marge estimée (40% du prix de vente)"
      - name: total_units_sold
        description: "Unités totales vendues"
      - name: gross_revenue
        description: "Chiffre d'affaires brut"
      - name: net_revenue
        description: "Chiffre d'affaires net (après remises)"
      - name: total_discounts
        description: "Total des remises accordées"
      - name: estimated_profit
        description: "Profit estimé"
      - name: profit_margin_percentage
        description: "Marge bénéficiaire en pourcentage"
      - name: orders_containing_product
        description: "Nombre de commandes contenant ce produit"
      - name: avg_discount_rate
        description: "Taux de remise moyen"
      - name: avg_revenue_per_order
        description: "Revenus moyens par commande"

  - name: int_sales__trends_analysis
    description: "Analyse des tendances de ventes mensuelles avec indicateurs de croissance"
    columns:
      - name: sales_year
        description: "Année des ventes"
      - name: sales_month
        description: "Mois des ventes"
      - name: sales_quarter
        description: "Trimestre des ventes"
      - name: year_month
        description: "Période année-mois"
      - name: store_name
        description: "Nom du magasin"
      - name: city
        description: "Ville du magasin"
      - name: state
        description: "État du magasin"
      - name: total_orders
        description: "Nombre total de commandes"
      - name: unique_customers
        description: "Nombre de clients uniques"
      - name: total_items_sold
        description: "Articles totaux vendus"
      - name: total_revenue
        description: "Revenus totaux"
      - name: total_discounts_given
        description: "Total des remises accordées"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: prev_month_revenue
        description: "Revenus du mois précédent"
      - name: revenue_growth_pct
        description: "Pourcentage de croissance des revenus"

  - name: int_sales__category_revenue
    description: "Contribution des catégories de produits aux revenus totaux"
    columns:
      - name: category_id
        description: "Identifiant unique de la catégorie"
      - name: category_name
        description: "Nom de la catégorie"
      - name: products_in_category
        description: "Nombre de produits dans la catégorie"
      - name: total_orders
        description: "Nombre total de commandes"
      - name: total_units_sold
        description: "Unités totales vendues"
      - name: gross_revenue
        description: "Chiffre d'affaires brut"
      - name: net_revenue
        description: "Chiffre d'affaires net"
      - name: total_discounts
        description: "Total des remises"
      - name: avg_product_price
        description: "Prix moyen des produits"
      - name: avg_discount_rate
        description: "Taux de remise moyen"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: revenue_rank
        description: "Classement par revenus"
      - name: revenue_contribution_pct
        description: "Contribution aux revenus totaux (%)"
      - name: products_per_order_ratio
        description: "Ratio produits par commande"
      - name: total_category_stock
        description: "Stock total de la catégorie"
      - name: avg_stock_per_product
        description: "Stock moyen par produit"

  - name: int_inventory__product_stock
    description: "Niveaux de stock agrégés par produit pour optimiser la gestion des inventaires"
    tests:
      - dbt_utils.unique_combination_of_columns:
          arguments:
            combination_of_columns: ['product_id']
            severity: error
      - dbt_utils.expression_is_true:
          arguments:
            expression: "total_stock_quantity >= 0"
      - not_null:
          column_name: product_id
    columns:
      - name: product_id
        description: "Identifiant unique du produit"
      - name: product_name
        description: "Nom du produit"
      - name: brand_name
        description: "Marque du produit"
      - name: category_name
        description: "Catégorie du produit"
      - name: model_year
        description: "Année modèle du produit"
      - name: list_price
        description: "Prix de vente"
      - name: total_stock_quantity
        description: "Quantité totale en stock"
      - name: stores_carrying_product
        description: "Nombre de magasins portant ce produit"
      - name: avg_stock_per_store
        description: "Stock moyen par magasin"
      - name: min_stock_per_store
        description: "Stock minimum par magasin"
      - name: max_stock_per_store
        description: "Stock maximum par magasin"

  - name: int_inventory__low_stock_alerts
    description: "Alertes pour les produits en rupture ou stock faible"
    columns:
      - name: store_id
        description: "Identifiant du magasin"
      - name: store_name
        description: "Nom du magasin"
      - name: product_id
        description: "Identifiant du produit"
      - name: product_name
        description: "Nom du produit"
      - name: brand_name
        description: "Marque du produit"
      - name: category_name
        description: "Catégorie du produit"
      - name: current_stock
        description: "Stock actuel"
      - name: stock_status
        description: "Statut du stock (Out of Stock, Critical, Low, Normal)"
      - name: list_price
        description: "Prix de vente"
      - name: stock_value
        description: "Valeur du stock"

  - name: int_inventory__stock_optimization
    description: "Optimisation des stocks avec recommandations pour maximiser les revenus"
    columns:
      - name: store_id
        description: "Identifiant du magasin"
      - name: store_name
        description: "Nom du magasin"
      - name: product_id
        description: "Identifiant du produit"
      - name: product_name
        description: "Nom du produit"
      - name: brand_name
        description: "Marque du produit"
      - name: category_name
        description: "Catégorie du produit"
      - name: current_stock
        description: "Stock actuel"
      - name: list_price
        description: "Prix de vente"
      - name: stock_value
        description: "Valeur du stock"
      - name: monthly_sales_velocity
        description: "Vélocité des ventes mensuelles"
      - name: months_of_stock_coverage
        description: "Mois de couverture de stock"
      - name: stock_optimization_status
        description: "Statut d'optimisation du stock"
      - name: revenue_impact
        description: "Impact sur les revenus"
      - name: recommendation
        description: "Recommandation d'action"

  - name: int_operations__staff_performance
    description: "Performance des employés avec métriques de vente"
    columns:
      - name: staff_id
        description: "Identifiant unique de l'employé"
      - name: first_name
        description: "Prénom de l'employé"
      - name: last_name
        description: "Nom de l'employé"
      - name: email
        description: "Adresse email de l'employé"
      - name: phone
        description: "Numéro de téléphone de l'employé"
      - name: active
        description: "Statut actif de l'employé"
      - name: store_name
        description: "Nom du magasin où travaille l'employé"
      - name: manager_first_name
        description: "Prénom du manager"
      - name: manager_last_name
        description: "Nom du manager"
      - name: total_orders_processed
        description: "Nombre total de commandes traitées"
      - name: unique_customers_served
        description: "Nombre de clients uniques servis"
      - name: total_items_sold
        description: "Nombre total d'articles vendus"
      - name: total_sales_revenue
        description: "Revenus totaux des ventes"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: first_order_date
        description: "Date de première commande traitée"
      - name: last_order_date
        description: "Date de dernière commande traitée"

  - name: int_operations__staff_revenue_performance
    description: "Performance détaillée des employés actifs avec rankings et tiers de performance"
    columns:
      - name: staff_id
        description: "Identifiant unique de l'employé"
      - name: staff_full_name
        description: "Nom complet de l'employé"
      - name: email
        description: "Adresse email de l'employé"
      - name: active
        description: "Statut actif de l'employé"
      - name: store_name
        description: "Nom du magasin"
      - name: city
        description: "Ville du magasin"
      - name: state
        description: "État du magasin"
      - name: orders_processed
        description: "Commandes traitées"
      - name: unique_customers_served
        description: "Clients uniques servis"
      - name: total_items_sold
        description: "Articles totaux vendus"
      - name: total_revenue
        description: "Revenus totaux générés"
      - name: avg_order_value
        description: "Valeur moyenne des commandes"
      - name: revenue_per_order
        description: "Revenus par commande"
      - name: orders_per_customer
        description: "Commandes par client"
      - name: first_order_date
        description: "Première commande traitée"
      - name: last_order_date
        description: "Dernière commande traitée"
      - name: days_active
        description: "Jours d'activité"
      - name: revenue_rank_in_store
        description: "Classement par revenus dans le magasin"
      - name: performance_tier
        description: "Tier de performance : Top, High, Good, Average, Low"
      - name: manager_name
        description: "Nom du manager"

  - name: int_operations__order_fulfillment
    description: "Métriques de traitement et livraison des commandes"
    columns:
      - name: order_id
        description: "Identifiant unique de la commande"
      - name: customer_id
        description: "Identifiant du client"
      - name: first_name
        description: "Prénom du client"
      - name: last_name
        description: "Nom du client"
      - name: staff_id
        description: "Identifiant de l'employé qui a traité la commande"
      - name: staff_first_name
        description: "Prénom de l'employé"
      - name: staff_last_name
        description: "Nom de l'employé"
      - name: store_name
        description: "Nom du magasin"
      - name: order_date
        description: "Date de la commande"
      - name: required_date
        description: "Date requise pour la livraison"
      - name: shipped_date
        description: "Date d'expédition"
      - name: order_status
        description: "Statut de la commande"
      - name: total_items
        description: "Nombre total d'articles dans la commande"
      - name: order_total
        description: "Montant total de la commande"
      - name: fulfillment_status
        description: "Statut de traitement (Overdue, Pending, On Time, Late)"
      - name: days_to_ship
        description: "Nombre de jours pour expédier"
      - name: days_past_due
        description: "Nombre de jours de retard"